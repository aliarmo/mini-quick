!function(t,e){for(var n in e)t[n]=e[n]}(exports,function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var r=n(1);function i(){this._evtObjs={},this._outdatedMsgs={}}function o(){}i.prototype.on=function(t,e,n){this._evtObjs[t]||(this._evtObjs[t]=[]),this._evtObjs[t].push({handler:e,once:n});var r=this;return function(){r.off(t,e)}},i.prototype.wait=function(t,e){return this._outdatedMsgs[t]?(e.apply(null,this._outdatedMsgs[t]),o):this.on(t,e,!0)},i.prototype.off=function(t,e){var n,i=this;return n=t?[t]:r.keys(this._evtObjs),r.forEach(n,function(t){if(e){var n=i._evtObjs[t]||[],o=[];r.forEach(n,function(t){t.handler!==e&&o.push(t)}),i._evtObjs[t]=o}else i._evtObjs[t]=[]}),this},i.prototype.emit=function(t){var e=Array.prototype.slice.call(arguments,1);this._outdatedMsgs[t]=e;var n=this._evtObjs[t]||[];r.forEach(n,function(t){t.once&&t.called||(t.called=!0,t.handler&&t.handler.apply(null,e))})},i.prototype.emitAsync=function(){var t=arguments,e=this;setTimeout(function(){e.emit.apply(e,t)},0)},i.prototype.assign=function(t){var e=this;r.forEach(["on","off","wait","emit","emitAsync"],function(n){var r=e[n];t[n]=function(){return r.apply(e,arguments)}})},(new i).assign(i);var a=i;let u,f={};const c="FIRST_SCREEN_NAME";var s=(t,e,n)=>{let r=function(t,e){return function(t){return u[t]}(t)[e||c]}(t,e);if(!r)throw new Error(`缺少名字为${t}模块名为${e}的数据源配置`);let i,o={fixBefore:t=>({data:{},header:{"content-type":"application/json"},method:"GET",dataType:"json",responseType:"text",...t}),fixAfter(t,e,n){let r=l(e,n);return e.isPersistent?wx.setStorage({key:r,data:t}):f[r]=t,[null,t]},onError(t,e,n){let r=l(e,n),i=e.isPersistent?wx.getStorageSync(r):f[r];return[i?null:t,i]}},a=r.url,s=r.fixBefore&&r.fixBefore(n);return(i=s&&s.then?s:Promise.resolve(s)).then(t=>{t={...o.fixBefore(n),...t};return new Promise((e,n)=>{console.log("request param",t);let i={url:a,...t,success(n){n&&function(t){return t>=200&&t<400}(n.statusCode)?e(function(e){let n;if(r.fixAfter){let i=r.fixAfter(e,t,a);n=i&&i[0]?i:o.fixAfter(i[1]||e,t,a)}else n=o.fixAfter(e,t,a);return n}(n)):i.fail(n)},fail(t){let n=function(t){let e;if(r.onError){let t=r.onError();e=t&&t.length?t:""}return e||o.onError(t)}(t);e(n)}};wx.request(i)})})};function l(t,e){return t.key||`${e}_${JSON.stringify(t)}`}var p=function(){return(p=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},h={};function g(t,e){var n=["onPageDataPreloadCallback","onPageDataFirstScreenCallback","onPageDataPagingCallback"];n.forEach(function(t){if(!e[t])throw new Error("缺少 "+t+" 方法")}),n.forEach(function(t){var n=e[t];e[t]=function(){var e=n.apply(this,arguments);return i[t](e)}});var r=e.$requestPageData;a.on("preload:"+t,function(){i.$onPreload()});var i={data:{state:""},onLoad:function(){var t=this.$take(),e=!0;t||(this.isCacheFirstScreen&&(t=this.$getFirstScreen()),e=!1),t&&(this.setData({state:t.state}),this.$setOrigin(t.origin)),e||this.$requestPageData()},$getOrigin:function(){return this._origin},$setOrigin:function(t){this._origin=t},$take:function(){var e=h[t];return h[t]=void 0,e},$put:function(e){h[t]=e},$setFirstScreen:function(e){wx.setStorage({key:t,data:e})},$getFirstScreen:function(){return wx.getStorageSync(t)},$onPreload:function(){this.$requestPageData("",!0)},$preload:function(t){a.emit("preload:"+t)},$requestPageData:function(t,n){var i=this;(r||this.$request).call(this,"",t).then(function(r){var o;console.log("EEEEEEE",r),n?(o=e.onPageDataPreloadCallback(r))&&o.origin&&o.state&&(i.$put(o),e.isCacheFirstScreen&&i.$setFirstScreen(o)):t?(o=i.onPageDataPagingCallback(r))&&(o.origin&&i.$setOrigin(o.origin),o.state&&i.setData({state:o.state})):(o=i.onPageDataFirstScreenCallback(r))&&(o.origin&&i.$setOrigin(o.origin),o.state&&i.setData({state:o.state}),o.origin&&o.state&&i.isCacheFirstScreen&&i.$setFirstScreen(o))}).catch(function(t){console.log("[error]",t)})},$request:function(e,n){return s(t,e,n)},$paging:function(){var t=this.onBeforePaging();this.$requestPageData(t)},onPageDataPreloadCallback:function(t){return t},onPageDataFirstScreenCallback:function(t){return t},onPageDataPagingCallback:function(t){return t}};e.$requestPageData=i.$requestPageData,e.data=p(p({},i.data),e.data),e.onLoad=function(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}(i.onLoad,e.onLoad||v),Page(p(p({},i),e))}g.requestFactory=s,g.first_screen_name=c;e.default=g;function v(){}},function(t,e,n){"use strict";function r(t,e){return t&&t.hasOwnProperty&&t.hasOwnProperty(e)}var i={escape:function(t){return t?String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;"):""},type:function(t){if(null===t)return"null";if(void 0===t)return"undefined";var e=/\[object (\w+)\]/.exec(Object.prototype.toString.call(t));return e?e[1].toLowerCase():""},keys:function(t){var e=[];return t?Object.keys?Object.keys(t):(this.objEach(t,function(t){e.push(t)}),e):e},bind:function(t,e){return t.bind?t.bind(e):function(){return t.apply(e,arguments)}},extend:function(t){if("object"!=this.type(t)&&"function"!=this.type(t))return t;for(var e,n,i=1,o=arguments.length;i<o;i++)for(n in e=arguments[i])r(e,n)&&(t[n]=e[n]);return t},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/gm,"")},indexOf:function(t,e){if(t.indexOf)return t.indexOf(e);var n=-1;return i.some(t,function(t,r){if(t===e)return n=r,!0}),n},forEach:function(t,e){if(t.forEach)return t.forEach(e);for(var n=t.length,r=0;r<n;r++)e(t[r],r);return t},some:function(t,e){if(t.some)return t.some(e);for(var n=t.length,r=!1,i=0;i<n;i++)if(e(t[i],i)){r=!0;break}return r},map:function(t,e){if(t.map)return t.map(e);for(var n=t.length,r=[],i=0;i<n;i++)r.push(e(t[i],i));return r},objEach:function(t,e){if(t)for(var n in t)if(r(t,n)&&!1===e(n,t[n]))break},reduce:function(t,e){if("function"!=i.type(e))throw new TypeError("Array.prototype.reduce callback must be a function");var n,r=t.length;if(0===r&&2===arguments.length)throw new TypeError("reduce of empty array with no initial value");var o=0;if(arguments.length>=3)n=arguments[2];else for(;;){if(o in t){n=t[o++];break}if(++o>=r)throw new TypeError("reduceRight of empty array with no initial value")}for(;o<r;o++)n=e(n,t[o],o,t);return n},filter:function(t,e,n){if(t.filter)return t.filter(e);for(var r=t.length,i=[],o=0;o<r;o++){var a=t[o];e.call(n,a,o,t)&&i.push(a)}return i},nextTick:function(){var t=this;return function(){setTimeout.apply(t,arguments)}}(),lock:function(t){var e;return function(){if(!e){e=!0;var n=[].slice.call(arguments,0);return n.unshift(function(){e=!1}),t.apply(this,n)}}},queue:function(t,e){var n=[],r=e=e||1;return function(){if(n.push([t,this,[].slice.call(arguments,0)]),r)return function t(){var i=n.shift();if(i){r--;var o=i[0],a=i[1],u=i[2];u.unshift(function(){r++,t.apply(this,arguments)}),setTimeout(function(){o.apply(a,u)})}else r=e}()}},delegator:function(t){var e,n=[];return function(r){if(e)return n.push(r);e=!0,t.call(this,function(){e=!1;var t=this,o=arguments;r&&r.apply(t,o);var a=n;n=[],i.forEach(a,function(e){e&&e.apply(t,o)})})}},once:function(t){var e,n=arguments;return function(){if(!e&&t)return e=!0,t.apply(n.length>=2?n[1]:null,arguments)}},verCompare:function(t,e){if(t===e)return 0;t=t.split("."),e=e.split(".");for(var n=t.length>=e.length?t.length:e.length,r=0;n--;){var i=Number(t[r]||0),o=Number(e[r++]||0);if(o>i)return 1;if(o<i)return-1}return 0},batchTimeout:function(t,e){var n=this,r=e/t;(!r||r<1)&&(t=1,r=e),r=Math.round(r);var i,o=!1,a=[],u=[];return function(t){a.push(t),o?u.push(+new Date):(i=+new Date,u.push(i),o=!0,setTimeout(function(){var t=Math.round(n.reduce(u,function(t,e){return t+(e-i)},0)/u.length);o=!1,u=[];var f=a.slice(0);a=[],setTimeout(function(){f.forEach(function(t){try{t&&t()}catch(t){console.error(t)}})},Math.max(e-r-t,0))},r))}}};t.exports=i}]));
//# sourceMappingURL=index.js.map